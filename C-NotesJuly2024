I wanted to create a macro that extracts table data in an doc file, its for program testing, so by just selecting the list incomplete variable name in the active sheet I want the macro to get the complete variable name, its variable data name and its LSB in the doc file by going to its location in the file explorer then selecting it, the doc file consist of many data but I want the macro to check the tables only and find whats necessary for me, the table usually have the complete variable name with its data name and its lsb in one line, each has its columns, can you make it for me?




Option Explicit

Sub ExtractSelectedVariableFromWord()
    Dim wdApp As Object, wdDoc As Object
    Dim fd As FileDialog
    Dim tbl As Object, rw As Object
    Dim wsOut As Worksheet
    Dim outRow As Long
    Dim searchValue As String
    Dim foundFlag As Boolean
    Dim filePath As String
    
    ' Get variable from current cell
    If IsEmpty(ActiveCell.Value) Then
        MsgBox "Please select a cell with the incomplete variable name ?", vbExclamation
        Exit Sub
    End If
    searchValue = Trim(ActiveCell.Value)
    
    ' Prompt user to select Word file
    Set fd = Application.FileDialog(msoFileDialogFilePicker)
    With fd
        .Title = "Select Word Document"
        .Filters.Clear
        .Filters.Add "Word Documents", "*.doc; *.docx"
        If .Show <> -1 Then Exit Sub
        filePath = .SelectedItems(1)
    End With
    
    ' Start Word
    On Error Resume Next
    Set wdApp = GetObject(, "Word.Application")
    If wdApp Is Nothing Then
        Set wdApp = CreateObject("Word.Application")
    End If
    On Error GoTo 0
    
    wdApp.Visible = False
    Set wdDoc = wdApp.Documents.Open(filePath, ReadOnly:=True)
    
    ' Prepare output sheet
    On Error Resume Next
    Set wsOut = ThisWorkbook.Sheets("Variables_Listing")
    If Not wsOut Is Nothing Then
        Application.DisplayAlerts = False
        wsOut.Delete
        Application.DisplayAlerts = True
    End If
    On Error GoTo 0
    
    Set wsOut = ThisWorkbook.Sheets.Add
    wsOut.Name = "Variables_Listing"
    
    ' Headers
    wsOut.Cells(1, 1).Value = "Variable Searched"
    wsOut.Cells(1, 2).Value = "LSB"
    wsOut.Cells(1, 3).Value = "Data Name (Japanese)"
    wsOut.Cells(1, 4).Value = "Complete Variable Name"
    
    outRow = 2
    foundFlag = False
    
    ' Loop Word tables
    For Each tbl In wdDoc.Tables
        For Each rw In tbl.Rows
            ' Col 1 = Variable Name
            If InStr(1, rw.Cells(1).Range.Text, searchValue, vbTextCompare) > 0 Then
                wsOut.Cells(outRow, 1).Value = searchValue
                wsOut.Cells(outRow, 2).Value = CleanCellText(rw.Cells(4).Range.Text) ' LSB
                wsOut.Cells(outRow, 3).Value = CleanCellText(rw.Cells(2).Range.Text) ' Data Name
                wsOut.Cells(outRow, 4).Value = CleanCellText(rw.Cells(1).Range.Text) ' Complete Var
                foundFlag = True
                Exit For
            End If
        Next rw
        If foundFlag Then Exit For
    Next tbl
    
    ' If not found
    If Not foundFlag Then
        wsOut.Cells(outRow, 1).Value = searchValue
        wsOut.Cells(outRow, 2).Value = "? Not found"
        wsOut.Cells(outRow, 3).Value = ""
        wsOut.Cells(outRow, 4).Value = ""
    End If
    
    ' Cleanup
    wdDoc.Close False
    wdApp.Quit
    Set wdDoc = Nothing
    Set wdApp = Nothing
    
    MsgBox "Search complete ?? Check 'Variables_Listing' sheet.", vbInformation
End Sub

' Helper to clean Word cell text
Function CleanCellText(txt As String) As String
    CleanCellText = Trim(Replace(txt, Chr(13) & Chr(7), ""))
End Function

